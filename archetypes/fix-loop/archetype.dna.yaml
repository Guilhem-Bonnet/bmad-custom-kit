$schema: "bmad-archetype-dna/v1"

id: fix-loop
name: "Fix Loop"
version: "1.0.0"
description: "Boucle de correction certifi√©e ‚Äî z√©ro 'done' sans preuve d'ex√©cution. FER sessions isol√©es, s√©v√©rit√© adaptative S1/S2/S3"
icon: "üîÅ"
author: "bmad-custom-kit"
tags: [fix, loop, tdd, certification, regression, evidence, quality]

inherits: minimal

traits:
  - name: proof-of-execution
    description: "Toute d√©claration 'done' exige une preuve d'ex√©cution"
    rule: "JAMAIS √©crire 'termin√©', 'fait', 'corrig√©' sans joindre : 1) la commande ex√©cut√©e, 2) la sortie r√©elle, 3) le CC PASS. Une d√©claration sans preuve est un mensonge."
    agents_affected: "*"
  - name: fer-isolation
    description: "Chaque session fix est isol√©e dans un FER (Fix Evidence Record)"
    rule: "Cr√©er un fichier YAML FER au d√©but de chaque session de fix. Y enregistrer chaque cycle test/fix/verify. Clore le FER avec signature avant de passer au ticket suivant."
    agents_affected: [fix-loop-orchestrator]
  - name: severity-adaptive
    description: "Processus adaptatif selon la s√©v√©rit√© S1/S2/S3"
    rule: "S3 (mineur) = cycle rapide 3 phases. S2 (moyen) = cycle standard 6 phases. S1 (critique) = toutes les 9 phases obligatoires incluant META-REVIEW et regression-check complet."
    agents_affected: [fix-loop-orchestrator]
  - name: never-assume-fixed
    description: "Ne jamais supposer qu'un fix est pass√© sans preuve"
    rule: "Apr√®s chaque fix : re-ex√©cuter TOUS les tests li√©s, pas seulement le test cibl√©. Un fix qui casse un autre test = FER non clos."
    agents_affected: "*"

constraints:
  - id: no-done-without-proof
    description: "Impossible de clore un FER sans preuve de CC PASS"
    enforcement: hard
    checked_by: fix-loop-orchestrator
  - id: no-parallel-fer
    description: "Maximum 1 FER actif par session (√©viter l'entrelacement)"
    enforcement: soft
    checked_by: fix-loop-orchestrator
  - id: regression-check-mandatory
    description: "V√©rification anti-r√©gression obligatoire en fin de session"
    enforcement: hard
    checked_by: fix-loop-orchestrator

values:
  - name: evidence-over-trust
    description: "La preuve prime sur la confiance aveugle dans le LLM"
    priority: 1
  - name: zero-regression
    description: "Un fix qui introduit une r√©gression est pire qu'aucun fix"
    priority: 1
  - name: isolated-context
    description: "Chaque cycle FER est isol√© du contexte des autres cycles"
    priority: 2

agents:
  - path: "../../archetypes/fix-loop/agents/fix-loop-orchestrator.tpl.md"
    required: true
    description: "Loop ‚Äî Orchestrateur boucle ferm√©e, FER, s√©v√©rit√© adaptative, META-REVIEW"

workflows:
  - path: "../../archetypes/fix-loop/workflows/workflow-closed-loop-fix.tpl.md"
    required: true
    description: "Workflow 9 phases boucle de correction certifi√©e"

shared_context_template: null
prompts_directory: null

compatible_with: [minimal, infra-ops, web-app, stack/go, stack/typescript, stack/python]
incompatible_with: []
requires: []

auto_detect:
  files: []
  directories: []
  confidence_boost: 0    # N'est pas auto-d√©tect√© ‚Äî doit √™tre explicitement demand√©
  exclusive: false

changelog:
  - version: "1.0.0"
    date: "2026-02-27"
    changes:
      - "DNA initiale ‚Äî traits proof-of-execution, FER-isolation, severity-adaptive, never-assume-fixed"
