$schema: "bmad-archetype-dna/v1"

id: stack/typescript
name: "Stack — TypeScript Expert"
version: "1.0.0"
description: "Agent spécialisé TypeScript/JavaScript — React, Vue, Next.js, Node, types stricts"
icon: "⚛️"
author: "bmad-custom-kit"
tags: [typescript, javascript, react, nextjs, vue, frontend, node, types]

inherits: minimal

traits:
  - name: strict-typescript
    description: "TypeScript strict:true sans any ni cast sauvage"
    rule: "tsconfig strict:true obligatoire. Zéro 'any' explicite, zéro 'as unknown as X'. Chaque type inconnu doit être défini ou importé via zod/io-ts."
    agents_affected: [typescript-expert]
    acceptance_criteria:
      - id: no-any-explicit
        description: "Aucune occurrence de ': any' ou 'as any' dans le code soumis"
        enforcement: hard
        context: "Type safety fondamentale"
        triggers_on: ["**/*.ts", "**/*.tsx"]
  - name: component-props-typed
    description: "Tous les composants React/Vue ont leurs props typées"
    rule: "Chaque composant déclare une interface ou type Props explicite. Les event handlers typés avec React.ChangeEvent<T>, React.FormEvent<T>."
    agents_affected: [typescript-expert]
    acceptance_criteria:
      - id: props-interface-declared
        description: "Chaque composant a une interface Props ou type Props déclarée"
        enforcement: soft
        context: "Documentation implicite + aide IDE"
        triggers_on: ["**/*.tsx", "**/*.vue"]
  - name: async-error-handling
    description: "Toutes les promesses gèrent leurs erreurs"
    rule: "Tout async/await dans un try/catch. Tout .then() avec .catch(). Pas de floating promises non gérées."
    agents_affected: [typescript-expert]
    acceptance_criteria:
      - id: no-unhandled-promise
        description: "Toutes les promesses ont une gestion d'erreur explicite"
        enforcement: hard
        context: "Prévention des crashes silencieux"
        triggers_on: ["**/*.ts", "**/*.tsx"]

tools_required:
  - name: node
    description: "Node.js >= 18 LTS"
    required: true
    check_command: "which node"
  - name: pnpm
    description: "Package manager rapide (ou npm/yarn)"
    required: false
    check_command: "which pnpm || which npm"
  - name: tsc
    description: "Compilateur TypeScript"
    required: true
    check_command: "which tsc || npx tsc --version"

constraints:
  - id: no-default-export-components
    description: "Préférer les exports nommés aux exports par défaut pour les composants"
    enforcement: soft
    checked_by: typescript-expert
  - id: colocate-tests
    description: "Les tests sont colocalisés avec le code (fichier.test.ts à côté de fichier.ts)"
    enforcement: soft
    checked_by: typescript-expert

acceptance_criteria:
  - id: tsc-no-errors
    description: "tsc --noEmit passe sans erreurs de typage"
    enforcement: hard
    context: "Compilation TypeScript propre obligatoire"
    triggers_on: ["**/*.ts", "**/*.tsx"]
    checked_by: typescript-expert
  - id: tests-pass-jest
    description: "jest --ci ou vitest run passe avec 0 failures"
    enforcement: hard
    context: "Suite de tests verte"
    triggers_on: ["**/*.test.ts", "**/*.spec.ts", "**/*.test.tsx"]
    checked_by: typescript-expert

compatible_with: [minimal, web-app, fix-loop, stack/docker]
incompatible_with: []
